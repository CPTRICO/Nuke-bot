const discord = require('discord.js');
const config = require('./config.json');
const fs = require('fs');
const mongo = require('./mongo');
const { Mongoose } = require('mongoose');
const Client = new discord.Client({
    intents: [discord.Intents.FLAGS.GUILDS, discord.Intents.FLAGS.GUILD_MESSAGES, discord.Intents.FLAGS.DIRECT_MESSAGES, discord.Intents.FLAGS.GUILD_INTEGRATIONS, discord.Intents.FLAGS.GUILD_MEMBERS],
    allowedMentions: { parse: ['users', 'roles'], repliedUser: true }
});

Client.commands = new discord.Collection();
Client.aliases = new discord.Collection();
Client.events = new discord.Collection();
Client.SlachCmds = new discord.Collection();
module.exports.Client = Client
require('./mongo')()


 // command Handler
fs.readdirSync('./commands/').forEach(dir => {
    
    fs.readdir(`./commands/${dir}`, (err, files) => {
        
       

        var jsFiles = fs.readdirSync('./commands/').filter(file => file.endsWith('.js'));
        if (jsFiles.length <= 0) return console.log('Kan ikke finde nogen kommandoer!');
        
        jsFiles.forEach(file => {
             var fileget = require(`./commands/${file}`);
            console.log(`File ${file} blev loaded`)
            try{
                Client.commands.set(fileget.help.name, fileget);

                fileget.help.aliases.forEach(alias => {
                    Client.aliases.set(alias, fileget.help.name);
                })
            }catch (err) {
                return console.log(err)
            }
        })
    })
})
// event handler
fs.readdirSync('./events/').forEach(dir => {
    
    fs.readdir(`./events/${dir}`, (err, files) => {
        
       

        var jsFiles = fs.readdirSync('./events/').filter(file => file.endsWith('.js'));
        if (jsFiles.length <= 0) return console.log('Kan ikke finde nogen Events!');
        
        jsFiles.forEach(file => {
             const eventget = require(`./events/${file}`);
            try{
                Client.events.set(eventget.name, eventget);

            }catch (err) {
                return console.log(err)
            }
        })
    })
})

// Slachcommand handler
fs.readdirSync('./SlachCommands/').forEach(dir => {
    
    fs.readdir(`./SlachCommands/${dir}`, (err, files) => {

        var jsFiles = fs.readdirSync('./SlachCommands/').filter(file => file.endsWith('.js'));
        if (jsFiles.length <= 0) return console.log('Kan ikke finde nogen SlachCommands!');
        
        jsFiles.forEach(file => {
             var fileget = require(`./SlachCommands/${file}`);
            try{
                Client.SlachCmds.set(fileget.help.name, fileget);
                console.log(`File ${file} blev loaded`)

            }catch (err) {
                return console.log(err)
            }
        })
    })
})

// NÃ¥r folk joiner && giver role == Afventer samtale
Client.on('guildMemberAdd', async guildMember => {
    let VelkommenRole = guildMember.guild.roles.cache.find(role => role.name === 'Afventer samtale');
    guildMember.roles.add(VelkommenRole);

}),

Client.login(config.Token)